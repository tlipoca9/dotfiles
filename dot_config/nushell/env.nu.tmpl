# env.nu - Nushell Environment Configuration
# This file is loaded before config.nu

# Home directory (Windows uses USERPROFILE, Unix uses HOME)
{{ if eq .chezmoi.os "windows" -}}
$env.HOME = $env.USERPROFILE
{{ end -}}

# XDG Base Directories
$env.XDG_CONFIG_HOME = ($env.HOME | path join ".config")
$env.XDG_DATA_HOME = ($env.HOME | path join ".local" "share")
$env.XDG_CACHE_HOME = ($env.HOME | path join ".cache")
$env.XDG_STATE_HOME = ($env.HOME | path join ".local" "state")

# Editor
$env.EDITOR = "nvim"

# PATH
$env.PATH = ($env.PATH | prepend ($env.HOME | path join ".local" "bin"))
$env.PATH = ($env.PATH | prepend ($env.HOME | path join ".opencode" "bin"))

{{ if eq .chezmoi.os "darwin" -}}
# Homebrew
{{ if eq .chezmoi.arch "amd64" -}}
$env.HOMEBREW_PREFIX = "/usr/local"
{{ else -}}
$env.HOMEBREW_PREFIX = "/opt/homebrew"
{{ end -}}
$env.HOMEBREW_CELLAR = ($env.HOMEBREW_PREFIX | path join "Cellar")
$env.HOMEBREW_REPOSITORY = $env.HOMEBREW_PREFIX
$env.PATH = ($env.PATH | prepend ($env.HOMEBREW_PREFIX | path join "bin"))
$env.PATH = ($env.PATH | prepend ($env.HOMEBREW_PREFIX | path join "sbin"))
{{ else if eq .chezmoi.os "linux" -}}
# Homebrew (Linuxbrew)
$env.HOMEBREW_PREFIX = "/home/linuxbrew/.linuxbrew"
$env.HOMEBREW_CELLAR = ($env.HOMEBREW_PREFIX | path join "Cellar")
$env.HOMEBREW_REPOSITORY = $env.HOMEBREW_PREFIX
$env.PATH = ($env.PATH | prepend ($env.HOMEBREW_PREFIX | path join "bin"))
$env.PATH = ($env.PATH | prepend ($env.HOMEBREW_PREFIX | path join "sbin"))
{{ end -}}

# Mise - runtime/tool version manager (shims mode, no per-command hook)
$env.PATH = ($env.PATH | prepend ($env.HOME | path join ".local" "share" "mise" "shims"))

# Atuin - shell history
# Only generate if files don't exist and atuin is available
# Run `atuin init nu | save ~/.config/nushell/atuin-init.nu --force` to regenerate
let atuin_init = ($nu.default-config-dir | path join "atuin-init.nu")
let atuin_comp = ($nu.default-config-dir | path join "atuin-completions.nu")
if not ($atuin_init | path exists) and (which atuin | is-not-empty) {
    atuin init nu | save $atuin_init --force
} else if not ($atuin_init | path exists) {
    touch $atuin_init
}
if not ($atuin_comp | path exists) and (which atuin | is-not-empty) {
    atuin gen-completions --shell nushell | save $atuin_comp --force
} else if not ($atuin_comp | path exists) {
    touch $atuin_comp
}
